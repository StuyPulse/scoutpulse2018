<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<script type="text/javascript" src="/lib/jquery-3.2.1.min.js"> </script>

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/toggle-icon/toggle-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-number-input/paper-number-input.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-button-group/paper-button-group.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-inputdata">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;

        --paper-input-container-label: {
          font-size: 1.55em;
          line-height: 100px;
        };
        --paper-input-container: {
          padding-top: 1.55em;
          padding-right: 4em;
          padding-left: 4em;
        };
        --paper-input-container-input: {
          font-size: 1.55em;
        };
      }

      .iconbig {
        --iron-icon-height: 40em;
        --iron-icon-width: 40em;
      }

      .fontsize {
        font-size: 2em;
      }

      .green-red {
        --toggle-icon: {
          color: var(--paper-green-500);
        };
        --toggle-icon-checked: {
          color: var(--paper-red-500);
        };
      }

      .notif_normal {
        --paper-toast-background-color: #323232;
        --paper-toast-color: #f1f1f1;
      }
      .notif_error {
        --paper-toast-background-color: #ff3232;
        --paper-toast-color: #f1f1f1;
      }
      paper-button.red {
        background-color: var(--paper-red-500);
        color: white;
        width: 180px;
        height: 150px;
      }
      paper-button.red[active] {
        background-color: var(--paper-green-500);
        width: 180px;
        height: 150px;
      }
      paper-button.input {
        background-color: var(--paper-red-500);
        color:white;
        width: 180px;
        height: 150px;
      }
      paper-button.input[active] {
        background-color: var(--paper-green-500);
        width: 180px;
        height: 150px;
      }
    </style>

    <div class="card">
        <paper-toast id="notif_toast_error" class="notif_error" text="Notification!" vertical-align horizontal-align > </paper-toast>
        <paper-toast id="notif_toast_normal" class="notif_normal" text="Notification!" vertical-align horizontal-align > </paper-toast>
      <div class="fontsize">
        <iron-form id="scout_form">
		    <form  method="post" action="/scout" >
            <div id="sheet_key_info" style="display:block">
              <paper-input always-float-label align="center" id="team" label="Team: "></paper-input>
	  		  <paper-button id="load_sheet_button" on-click="load_data"> Load Sheet </paper-button>
            </div>
			  <div id="loadable_sheet" style="display:none">
              <div class="rectangle" class="fontsize" style="font-size:24px;">Scouting</div>
				<h3> <p id="loadable_sheet_team_number" style=""> </h3>
                <paper-dropdown-menu id="match_type" label="Match Type">
                  <paper-listbox slot="dropdown-content" selected="1">
                    <paper-item>Practice</paper-item>
                    <paper-item>Qualifier</paper-item>
                    <paper-item>Quarterfinals</paper-item>
                    <paper-item>Semifinals</paper-item>
                    <paper-item>Finals</paper-item>
                  </paper-listbox>
                </paper-dropdown-menu>
                <paper-input always-float-label id="match_number" label="Match Number: "></paper-input>
               <iron-label for="methodScoring">
                 Method of Acquiring
               </iron-label>
               <br>
               <paper-button-group id="methodScoring" selected = "methodScoring">
                <paper-button toggles raised class="custom red"> Place </paper-button>
                <paper-button toggles raised class="custom red"> Shoot Cube </paper-button>
                <paper-button toggles raised on-click="load_text_method_scoring" class="custom red"> Other </paper-button>
                <!--<div id="loadable_text0" style="display:none">
                    <paper-input always-float-label id="methodScoringOther"> </paper-input>
                </div> -->
               </paper-button-group>
               <br>

               <iron-label for="methodAcquiring">
                Method of Acquiring
               </iron-label>
               <paper-button-group id="methodAcquiring" selected = "methodAcquiring">
                <paper-button toggles raised class="custom red"> Floor </paper-button> 
                <paper-button toggles raised class="custom red"> Portal </paper-button>
                <paper-button toggles raised on-click="load_text_method_acquiring" class="custom red"> Other </paper-button>
                <!-- <div id="loadable_text1" style="display:none">
                    <paper-input always-float-label id="methodAcquiringOther"> </paper-input>
                </div> -->
               </paper-button-group>
               <br>

               <iron-label for="climbMech">
                Climb Mechanism
               </iron-label>
               <paper-button-group id="climbMech" selected="climbMech">
                <paper-button toggles raised class="custom red"> Rung </paper-button>
          		<paper-button toggles raised class="custom red"> Ramp </paper-button>
          		<paper-button toggles raised class="custom red"> Rung Expansion </paper-button>
          		<paper-button toggles raised on-click-"load_text_climb_mech" class="custom red"> Other </paper-button>
          		<!-- <div id="loadable_text2" style="display:none">
          		    <paper-input always-float-label id="climbMechOther"> </paper-input>
          	    </div> -->
          	   </paper-button-group>
          		<br>
          		<hr>
          		<h4> Autonomous: </h4>
          		<iron-label for="moblity">
          		  Mobility?
          		</iron-label>
                <paper-button-group id="mobility">
                    <paper-button toggles raised class="custom red" name="YES">Yes</paper-button>
                    <paper-button toggles raised class="custom red" name="NO" selected>No</paper-button>
                </paper-button-group>
          		<br>
              <br>
            <iron-label for="autonSwitchCubes">
              Amount of Power Cubes on Switch:
            </iron-label>
            <br>
            <paper-button-group id="autonSwitchCubes" selected = "0">
              <paper-button toggles raised class="custom red">0</paper-button>
                <paper-button toggles raised class="custom red">1</paper-button>
                <paper-button toggles raised class="custom red">2</paper-button>
                <paper-button toggles raised class="custom red">3</paper-button>
                <paper-button toggles raised class="custom red">4</paper-button>
                <paper-button toggles raised class="custom red">5</paper-button>
                <paper-button toggles raised class="custom red">6</paper-button>
                <paper-button toggles raised on-click="load_text_switch_cubes" class="custom input">7+</paper-button>
				<div id="loadable_text3" style="display:none">
					<paper-input always-float-label id="autonSwitchCubes7" label="If there are 7+ Cubes, Input here."> </paper-input>

				</div>

             </paper-button-group>
             <br>
             <br>

             <iron-label for="autonScaleCubes">
               Number of Power Cubes on Scale:
             </iron-label>
             <br>
             <paper-button-group id="autonScaleCubes" selected = "0">
               <paper-button toggles raised class="custom red">0</paper-button>
                 <paper-button toggles raised class="custom red">1</paper-button>
                 <paper-button toggles raised class="custom red">2</paper-button>
                 <paper-button toggles raised class="custom red">3</paper-button>
                 <paper-button toggles raised class="custom red">4</paper-button>
                 <paper-button toggles raised class="custom red">5</paper-button>
                 <paper-button toggles raised class="custom red">6</paper-button>
                 <paper-button toggles raised on-click="load_text_scale_cubes_auton" class="custom input">7+</paper-button>
				 <div id="loadable_text4" style="display:none">
					<paper-input always-float-label id="autonScaleCubes7" label="If there are 7+ Cubes, Input here."> </paper-input>
				 </div>

              </paper-button-group>
              <br>
              <br>


          		<h4>Teleop:</h4>
          		<div>
                <iron-label for="allianceSwitchCubes">
                  Number of Alliance Switch Power Cubes:
                </iron-label>
                <br>
                <paper-button-group id="allianceSwitchCubes" selected = "0">
                    <paper-button toggles raised class="custom red">0</paper-button>
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
                    <paper-button toggles raised on-click="load_text_alliance_switch_cubes" class="custom input">7+</paper-button>
					<div id="loadable_text5" style="display:none">
						<paper-input always-float-label id="allianceSwitchCubes7" label="If there are 7+ Cubes, Input here."> </paper-input>
					</div>

                 </paper-button-group>
               <br>
               <br>

               <iron-label for="opposingSwitchCubes">
                 Number of Opposing Switch Power Cubes:
          		  <iron-label>
                  <br>
                  <paper-button-group id="opposingSwitchCubes" selected = "0">
                    <paper-button toggles raised class="custom red">0</paper-button>
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
					<paper-button toggles raised on-click="load_text_opposing_switch_cubes" class="custom input">7+</paper-button>
					<div id="loadable_text6" style="display:none">
						<paper-input always-float-label id="opposingSwitchCubes7" label="If there are 7+ Cubes, Input here."> </paper-input>
					</div>

                   </paper-button-group>
                 <br>
                 <br>

                 <iron-label for="teleopScaleCubes">
                  Number of Power Cubes on the Scale:
                </iron-label>
                <br>
                <paper-button-group id="teleopScaleCubes" selected = "0">
                  <paper-button toggles raised class="custom red">0</paper-button>
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
					<paper-button toggles raised on-click="load_text_scale_cubes_teleop" class="custom input">7+</paper-button>
					<div id="loadable_text7" style="display:none">
						<paper-input always-float-label id="teleopScaleCubes7" label="If there are 7+ Cubes, Input here."> </paper-input>
					</div>

                 </paper-button-group>
                <br>
                <br>

                <iron-label for="exchange">
                  Power Cubes in Exchange:
                </iron-label>
                <br>
                <paper-button-group id="exchange" selected = "0">
                    <paper-button toggles raised class="custom red">0</paper-button>
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
					<paper-button toggles raised on-click="load_text_exchange_cubes" class="custom input">7+</paper-button>
					<div id="loadable_text8" style="display:none">
						<paper-input always-float-label id="exchange7" label="If there are 7+ Cubes, Input here."> </paper-input>
					</div>

                 </paper-button-group>
                  <br>
                  <h4> End Game: </h4>
                  <iron-label for="climb">
          		    Climb?
          		  </iron-label>
                <paper-button-group  id="climb" selected="climb" aria-labelledby="climb">
                 <paper-button toggles raised class="custom red" name="YES"> Yes </paper-button>
                 <paper-button toggles raised class="custom red" name="NO" selected> No </paper-button>
                 <paper-button toggles raised class="custom red" name="ASSISTED"> Assisted </paper-button>
                 <paper-button toggles raised class="custom red" name="PLATOFRM"> Platform </paper-button>
               </paper-button-group>
                   <br>
                   <br>
          		  <iron-label for="assistedOption">
          		  	Robots Assisted?
          		  </iron-label>
          		  <paper-button-group id="assistedOption" selected="assistedOption" aria-labelledby="assistedOption">
                  <paper-button toggles raised class="custom red" name="NONE" selected> None </paper-button>
                    <paper-button toggles raised class="custom red" name="ONE"> One </paper-button>
                    <paper-button toggles raised class="custom red" name="TWO"> Two </paper-button>
                  </paper-button-group>
          		  <br>
                <br>
          		</div>
	  	  	    <paper-button on-click="submit_data"> Submit </paper-button>
      		    <paper-button on-click="close_data"> Edit other sheet </paper-button>
			  		</div>
			  	</form>
      	</iron-form>
	  	 	<p id="success_log"></p>
	  	  <p id="error_log"></p>
			</div>
		</div>
	</template>

  <script>
    class MyInputData extends Polymer.Element {
      	static get is() { return 'my-inputdata'; }
            // Sets a notif message that pops up
            set_notif_error_message(message) {
                this.$.notif_toast_error.set("text", message)
                this.$.notif_toast_error.center();
                this.$.notif_toast_error.refit();
                this.$.notif_toast_error.open();
            }
            // Sets a notif message that pops up
            set_notif_normal_message(message) {
                this.$.notif_toast_normal.set("text", message)
                this.$.notif_toast_normal.center();
                this.$.notif_toast_normal.refit();
                this.$.notif_toast_normal.open();
            }
    		load_data() {
            var match = this.$.match_type.value + "" + this.$.match_number.value;
            console.log("MATCH: " + match);
            var team = this.$.team.value;
            //Fill form with default values:
            this.$.climb.selected = "NO";
            this.$.match_type.value = "";
            this.$.match_number.value = "";
            this.$.methodScoring.selected = "0";
            this.$.methodAcquiring.selected = "0";
            this.$.climbMech.selected = "0";
            this.$.mobility.selected = "YES";
            this.$.autonSwitchCubes.selected = "0";
            this.$.autonScaleCubes.selected = "0";
            this.$.allianceSwitchCubes.selected = "0";
            this.$.opposingSwitchCubes.selected = "0";
            this.$.teleopScaleCubes.selected = "1";
            this.$.exchange.selected = "0";
            this.$.assistedOption.selected = "NONE";
						// Try to find data in server and fill in our form
						$.ajax({
                url: "/getdata?match_number=" + match + "&team_number=" + team,
                type: "GET",
                success: (data) => { // We use Lambda (=>) instead of function() because it preserves "this"
                    if (data.length == 0) {
												this.set_notif_normal_message("No data found! Starting new sheet");
                        return;
										}
        						console.log(data);
                    data = data[0]; // object is stored in array
                    this.$.climb.selected = data.climb;
                    this.$.match_type.value = data.match_type;
                    this.$.match_number.value = data.match_number;
                    this.$.methodScoring.selected = data.methodScoring;
                    this.$.methodAcquiring.selected = data.methodAcquiring;
                    this.$.climbMech.selected = data.climbMech;
                    this.$.mobility.selected = data.mobility;
                    this.$.autonSwitchCubes.selected = data.autonSwitchCubes;
                    this.$.autonScaleCubes.selected = data.autonScaleCubes;
                    this.$.allianceSwitchCubes.selected = data.allianceSwitchCubes;
                    this.$.opposingSwitchCubes.selected = data.opposingSwitchCubes;
                    this.$.teleopScaleCubes.selected = data.teleopScaleCubes;
                    this.$.exchange.selected = data.exchange;
                    this.$.assistedOption.selected = data.assistedOption;
								},
			 					error: function(data) {
										this.set_notif_error_message("ERROR: Did not load data, "
													+ "prior data might exist, and you will OVERWRITE it."
                          + "Be wary when uploading");
								}
						});
						this.$.loadable_sheet.style.display="block";
						this.$.sheet_key_info.style.display="none";
            //this.$.load_sheet_button.style.display="none";
				    this.$.loadable_sheet_team_number.innerHTML = "Team " + team;
                  }

				close_data() {
						this.$.loadable_sheet.style.display="none";
						this.$.sheet_key_info.style.display="block";
            //this.$.load_sheet_button.style.display="block";
				}

                load_text_method_scoring() {
                        this.$.loadable_text0.style.display="block";
                }

                load_text_method_acquiring() {
                        this.$.loadable_text1.style.display="block";
                }

                load_text_climb_mech() {
                        this.$.loadable_text2.style.display="block";
                }

				load_text_switch_cubes() {
						this.$.loadable_text3.style.display="block";
				}

				load_text_scale_cubes_auton() {
						this.$.loadable_text4.style.display="block";
				}

				load_text_alliance_switch_cubes() {
						this.$.loadable_text5.style.display="block";
				}

				load_text_opposing_switch_cubes() {
						this.$.loadable_text6.style.display="block";
				}

				load_text_scale_cubes_teleop() {
						this.$.loadable_text7.style.display="block";
				}

				load_text_exchange_cubes() {
                        this.$.loadable_text8.style.display ="block";
				}

    		submit_data() {
      			//var form = $("#scout_form");

            //Changes selected numerical values to strings.
            //Mobility
            if (this.$.mobility.selected == 0) {
              this.$.mobility.value = "YES"
            }
            else {this.$.mobility.value = "NO"}
            
            //Method of Scoring
            if (this.$.methodScoring.selected == 0) {
              this.$.methodScoring.value = "Place"
            }
            if (this.$.methodScoring.selected == 1) {
              this.$.methodScoring.value = "Shoot Cube"
            }

            //Method of Acquiring
            if (this.$.methodAcquiring.selected == 0) {
              this.$.methodAcquiring.value = "Floor"
            }
            if (this.$.methodAcquiring.selected == 1) {
              this.$.methodAcquiring.value = "Portal"
            }
        
            //Climb Mechanism
            if (this.$.climbMech.selected == 0) {
              this.$.climbMech.value = "Rung"
            }
            if (this.$.climbMech.selected == 1) {
              this.$.climbMech.value == "Ramp"
            }
            if (this.$.climbMech.selected == 2) {
              this.$.climbMech.value == "Rung Expansion"
            }

            //climb:
            if (this.$.climb.selected == 0 ) {
              this.$.climb.value = "YES"
            }
            if (this.$.climb.selected == 1 ) {
              this.$.climb.value = "NO"
            }
            if (this.$.climb.selected == 2 ) {
              this.$.climb.value = "ASSISTED"
            }
            if (this.$.climb.selected == 3 ) {
              this.$.climb.value = "PLATFORM"
            }
            
            //assistedOption
            if (this.$.assistedOption.selected == 0) {
              this.$.assistedOption.value = "NONE"
            }
            if (this.$.assistedOption.selected == 1) {
              this.$.assistedOption.value = 1
            }
            if (this.$.assistedOption.selected == 2) {
              this.$.assistedOption.value = 2
            }

            // Set a variable, "info" to the data.
      			var info = {
              	team_number: this.$.team.value,
        		match_type: this.$.match_type.value,
                match_number: this.$.match_number.value,
                methodScoring: this.$.methodScoring.value,
//                methodScoringOther: this.$.methodScoringOther.value,
                methodAcquiring: this.$.methodAcquiring.value,
                climbMech: this.$.climbMech.value,
                mobility: this.$.mobility.value,
                autonSwitchCubes: this.$.autonSwitchCubes.selected,
                autonSwitchCubes7: this.$.autonSwitchCubes7.value,
                autonScaleCubes: this.$.autonScaleCubes.selected,
                autonScaleCubes7: this.$.autonScaleCubes7.value,
                allianceSwitchCubes: this.$.allianceSwitchCubes.selected,
                allianceSwitchCubes7: this.$.allianceSwitchCubes7.value,
                opposingSwitchCubes: this.$.opposingSwitchCubes.selected,
                opposingSwitchCubes7: this.$.opposingSwitchCubes7.value,
                teleopScaleCubes: this.$.teleopScaleCubes.selected,
                teleopScaleCubes7: this.$.teleopScaleCubes7.value,
                exchange: this.$.exchange.selected,
                exchange7: this.$.exchange7.value,
                climb: this.$.climb.value,
                assistedOption: this.$.assistedOption.value
      			};
      			console.log(this.$.mobility.selected);
            console.log("Match Type: " + this.$.match_type.value + ", Match Number: " + this.$.match_number.value);
      			//console.log(!this.$.yellow_card.checked);
	  				//console.log(this.$.comments.value);
	  				//console.log(this.$.successgr);
	  				//console.log(this.$.successgr.selected);
	  				console.log(info);
	  				/*console.log(this.$.team.value);
    				  console.log(form.serialize());*/
                var base = this;
      			$.ajax({
      			    url: "/scout",
      			    type: "post",
      			    data: info,//scout_form.serialize(),
      			    success: function(data) {
                    base.set_notif_normal_message("Successfully Updated!");
                    console.log("Result: " + data.result);
                    /*if (data.result === "success") {
      			            this.set_notif_normal_message("Successfully Updated!");
                    } else if (data.result === "invalid") {
      			            // TODO: Do we even need this?
                        this.set_notif_error_message("Invalid data! "
                        + "Make sure that all inputs are less than 255 and greater than 0");
      			        }*/
      			    },
      			    error: function() {
                    base.set_notif_error_message("Failed to update!"
                        + " Either your internet is bad, or your data is invalid! (counters must be 0 to 255 only)");
                    /*(base.set_notif_error_message("Invalid data! "
                    + "Make sure that all inputs are less than 255 and greater than 0");*/
      			        /*$("#error_log").html("Failed to update. Try using QR (once we get that up and running)");
      			        $("#success_log").html("");*/
      			    }
						});
    		}
    }
    window.customElements.define(MyInputData.is, MyInputData);
  </script>
</dom-module>
