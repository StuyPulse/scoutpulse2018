<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<script type="text/javascript" src="/lib/jquery-3.2.1.min.js"> </script>

<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/paper-checkbox/paper-checkbox.html">
<link rel="import" href="../bower_components/paper-radio-button/paper-radio-button.html">
<link rel="import" href="../bower_components/paper-radio-group/paper-radio-group.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/toggle-icon/toggle-icon.html">
<link rel="import" href="../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../bower_components/paper-number-input/paper-number-input.html">
<link rel="import" href="../bower_components/iron-form/iron-form.html">
<link rel="import" href="../bower_components/paper-input/paper-textarea.html">
<link rel="import" href="../bower_components/paper-toast/paper-toast.html">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../bower_components/paper-item/paper-item.html">
<link rel="import" href="../bower_components/paper-button/paper-toggle-button.html">
<link rel="import" href="../bower_components/paper-button-group/paper-button-group.html">
<link rel="import" href="shared-styles.html">

<dom-module id="my-inputdata">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 10px;
      }
      .green-red {
        --toggle-icon: {
          color: var(--paper-green-500);
        };
        --toggle-icon-checked: {
          color: var(--paper-red-500);
        };
      }
      .notif_normal {
        --paper-toast-background-color: #323232;
        --paper-toast-color: #f1f1f1;
      }
      .notif_error {
        --paper-toast-background-color: #ff3232;
        --paper-toast-color: #f1f1f1;
      }
      paper-button.red {
    background-color: var(--paper-red-500);
    color: white;
  }
    paper-button.red[active] {
    background-color: var(--paper-green-500);
    }
    paper-button.input {
      background-color: var(--paper-red-500);
      color:white;
    }
    paper-button.input[active] {
    background-color: var(--paper-green-500);
    }
    </style>

    <div class="card">
        <paper-toast id="notif_toast_error" class="notif_error" text="Notification!" vertical-align horizontal-align > </paper-toast>
        <paper-toast id="notif_toast_normal" class="notif_normal" text="Notification!" vertical-align horizontal-align > </paper-toast>
      <div>
        <iron-form id="scout_form">
			    <form  method="post" action="/scout" >
            <div id="sheet_key_info" style="display:block">
              <div class="rectangle">Input</div>
              <paper-input always-float-label align="center" id="team" label="Team: "></paper-input>
	  				<paper-button id="load_sheet_button" on-click="load_data"> Load Sheet </paper-button>
            </div>
						<div id="loadable_sheet" style="display:none">
              <div class="rectangle" style="font-size:24px;">Scouting</div>
							<h3> <p id="loadable_sheet_team_number" style=""> </h3>
                <paper-dropdown-menu id="match_type" label="Match Type">
                  <paper-listbox slot="dropdown-content" selected="1">
                    <paper-item>Practice</paper-item>
                    <paper-item>Qualifier</paper-item>
                    <paper-item>Quarterfinals</paper-item>
                    <paper-item>Semifinals</paper-item>
                    <paper-item>Finals</paper-item>
                  </paper-listbox>
                </paper-dropdown-menu>
                <paper-input always-float-label align="center" id="match" label="Match Number: "></paper-input>
                <paper-input always-float-label align="center" id="methodScoring" label="Method of Scoring: "> </paper-input>
                <paper-input always-float-label align="center" id="methodAcquiring" label="Method of Acquiring: "> </paper-input>
                <paper-input always-float-label align="center" id="climbMech" label="Climb Mechanism: "> </paper-input>
          		<br>
          		<hr>
          		<h4> Autonomous: </h4>
          		<iron-label for="moblity">
          		  Mobility?
          		</iron-label>
               <toggle-icon id="mobility" required=true icon="icons:thumb-up" animation="flip-vertical" class="green-red"></toggle-icon>
          		<br>
              <br>
              <iron-label for="autonSwitchCubes">
              Number of Power Cubes on Switch:
            </iron-label>
            <br>
            <paper-button-group id="autonSwitchCubes" selected = "0">
                <paper-button toggles raised class="custom red">1</paper-button>
                <paper-button toggles raised class="custom red">2</paper-button>
                <paper-button toggles raised class="custom red">3</paper-button>
                <paper-button toggles raised class="custom red">4</paper-button>
                <paper-button toggles raised class="custom red">5</paper-button>
                <paper-button toggles raised class="custom red">6</paper-button>
                <paper-button toggles raised on-click="load_text_switch_cubes" class="custom input">7+</paper-button>
		<div id="loadable_text0" style="display:none">
			<paper-textarea label="If there are 7+ Cubes, Input here."> </paper-textarea>
		</div>
		</paper-button-group>
		<br>
		<br>
				
             <iron-label for="autonScaleCubes">
               Number of Power Cubes on Scale:
             </iron-label>
             <br>
             <paper-button-group id="autonScaleCubes" selected = "0">
                 <paper-button toggles raised class="custom red">1</paper-button>
                 <paper-button toggles raised class="custom red">2</paper-button>
                 <paper-button toggles raised class="custom red">3</paper-button>
                 <paper-button toggles raised class="custom red">4</paper-button>
                 <paper-button toggles raised class="custom red">5</paper-button>
                 <paper-button toggles raised class="custom red">6</paper-button>
                 <paper-button toggles raised on-click="load_text_scale_cubes_auton" class="custom input">7+</paper-button>
	         <div id="loadable_text1" style="display:none">
		      <paper-textarea label="If there are 7+ Cubes, Input here."> </paper-textarea>
		 </div>

              </paper-button-group>
              <br>
              <br>
			  
          		<h4>Teleop:</h4>
          		<div>
                <iron-label for="allianceSwitchCubes">
                  Number of Alliance Switch Power Cubes:
                </iron-label>
                <br>
                <paper-button-group id="allianceSwitchCubes" selected = "0">
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
                    <paper-button toggles raised on-click="load_text_alliance_switch_cubes" class="custom input">7+</paper-button>
		    <div id="loadable_text2" style="display:none">
		    	<paper-textarea label="If there are 7+ Cubes, Input here."> </paper-textarea>
		    </div>
			
	            </paper-button-group>
		    <br>
	            <br>

               <iron-label for="opposingSwitchCubes">
                 Number of Opposing Switch Power Cubes:
          	</iron-label>
                  <br>
                  <paper-button-group id="opposingSwitchCubes" selected = "0">
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
		    <paper-button toggles raised on-click="load_text_opposing_switch_cubes" class="custom input">7+</paper-button> 
		    <div id="loadable_text3" style="display:none">
			<paper-textarea label="If there are 7+ Cubes, Input here."> </paper-textarea>
		    </div>

                   </paper-button-group>
                 <br>
                 <br>

                 <iron-label for="teleopScaleCubes">
                  Number of Power Cubes on the Scale:
                </iron-label>
                <br>
                <paper-button-group id="teleopScaleCubes" selected = "0">
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
		    <paper-button toggles raised on-click="load_text_scale_cubes_teleop" class="custom input">7+</paper-button> 
		    <div id="loadable_text4" style="display:none">
			<paper-textarea label="If there are 7+ Cubes, Input here."> </paper-textarea>
		    </div>

                 </paper-button-group>
                <br>
                <br>

                <iron-label for="exchange">
                  Number of Power Cubes in the Exchange:
                </iron-label>
                <br>
                <paper-button-group id="exchange" selected = "0">
                    <paper-button toggles raised class="custom red">1</paper-button>
                    <paper-button toggles raised class="custom red">2</paper-button>
                    <paper-button toggles raised class="custom red">3</paper-button>
                    <paper-button toggles raised class="custom red">4</paper-button>
                    <paper-button toggles raised class="custom red">5</paper-button>
                    <paper-button toggles raised class="custom red">6</paper-button>
		    <paper-button toggles raised on-click="load_text_exchange_cubes" class="custom input">7+</paper-button> 
		    <div id="loadable_text5" style="display:none">
			<paper-textarea label="If there are 7+ Cubes, Input here."> </paper-textarea>
	            </div>

                 </paper-button-group>
                  <br>
                  <h4> EndGame: </h4>
                  <iron-label for="climb">
          		    Climb?
          		  </iron-label>
                <paper-button-group id="climb">
                 <paper-button toggles raised class="custom red" name="YES"> Yes </paper-button>
                 <paper-button toggles raised class="custom red" name="NO"> No </paper-button>
                 <paper-button toggles raised class="custom red" name="ASSISTED"> Assisted </paper-button>
                 <paper-button toggles raised class="custom red" name="PLATFORM"> Platform </paper-button>
               </paper-button-group>
                   <br>
                   <br>
          	<iron-label for="assistedOption">
          		Robots Assisted?
          	</iron-label>
          	<paper-button-group id="assistedOption">
                  <paper-button toggles raised class="custom red" name="NONE"> None </paper-button>
                  <paper-button toggles raised class="custom red" name="ONE"> One </paper-button>
                  <paper-button toggles raised class="custom red" name="TWO"> Two </paper-button>
                </paper-button-group>
          	<br>
                <br>
                <br>
                <br>
          	</div>
	  	  <paper-button on-click="submit_data"> Submit </paper-button>
      		<paper-button on-click="close_data"> Edit other sheet </paper-button>
			  		</div>
			  	</form>
      	</iron-form>
	  	 	<p id="success_log"></p>
	  	  <p id="error_log"></p>
			</div>
		</div>
	</template>

  <script>
    class MyInputData extends Polymer.Element {
      	static get is() { return 'my-inputdata'; }
            // Sets a notif message that pops up
            set_notif_error_message(message) {
                this.$.notif_toast_error.set("text", message)
                this.$.notif_toast_error.center();
                this.$.notif_toast_error.refit();
                this.$.notif_toast_error.open();
            }
            // Sets a notif message that pops up
            set_notif_normal_message(message) {
                this.$.notif_toast_normal.set("text", message)
                this.$.notif_toast_normal.center();
                this.$.notif_toast_normal.refit();
                this.$.notif_toast_normal.open();
            }
    		load_data() {
		var match = this.$.match_type.value + " " + this.$.match.value;
		console.log("MATCH: " + match);
                var team = this.$.team.value;
	    // First fill our form with its default values, clean slate
            // Not necessraily required. This "feature" is present in most of the elements.
            this.$.mobility.checked = "TRUE"
	    this.$.climb.selected = "NO";
	    // Try to find data in server and fill in our form
	    $.ajax({
                url: "/getdata?match_number=" + match + "&team_number=" + team,
                type: "GET",
                success: (data) => { // We use Lambda (=>) instead of function() because it preserves "this"
                    if (data.length == 0) {
		        this.set_notif_normal_message("No data found! Starting new sheet");
                        return;
										}
        	    console.log(data);
                    data = data[0]; // object is stored in array
                    this.$.match_number.value,
                    this.$.methodScoring.value,
                    this.$.methodAcquiring.value,
                    this.$.climbMech.value,
                    this.$.mobility.checked  ? 1 : 0,
                    this.$.autonSwitchCubes.value,
                    this.$.autonScaleCubes.value,
                    this.$.allianceSwitchCubes.value,
                    this.$.opposingSwitchCubes.value,
                    this.$.teleopScaleCubes.value,
                    this.$.exchange.value,
										this.$.climb.value = data.climb
								},
			 					error: function(data) {
										this.set_notif_error_message("ERROR: Did not load data, "
													+ "prior data might exist, and you will OVERWRITE it."
                          + "Be wary when uploading");
								}
						});
						this.$.loadable_sheet.style.display="block";
						this.$.sheet_key_info.style.display="none";
						this.$.toggle_button.style.display="button";
            //this.$.load_sheet_button.style.display="none";
				    this.$.loadable_sheet_team_number.innerHTML = "Team " + team;
        }
				close_data() {
						this.$.loadable_sheet.style.display="none";
						this.$.sheet_key_info.style.display="block";
            //this.$.load_sheet_button.style.display="block";
				}
				load_text_switch_cubes() {
						this.$.loadable_text0.style.display="block";
				}
				
				load_text_scale_cubes_auton() {
						this.$.loadable_text1.style.display="block";
				}
				
				load_text_alliance_switch_cubes() {
						this.$.loadable_text2.style.display="block";
				}
				
				load_text_opposing_switch_cubes() {
						this.$.loadable_text3.style.display="block";
				}
				
				load_text_scale_cubes_teleop() {
						this.$.loadable_text4.style.display="block";
				}
				
				load_text_exchange_cubes() {
						this.$.loadable_text5.style.display="block";
				}
				
    		submit_data() {
      			//var form = $("#scout_form");
      			var info = {
                team_number: this.$.team.value,
        				match_number: this.$.match_type.value + " " + this.$.match.value,
                methodScoring: this.$.methodScoring.value,
                methodAcquiring: this.$.methodAcquiring.value,
                climbMech: this.$.climbMech.value,
                mobility: this.$.mobility.checked ? 1 : 0,
                autonSwitchCubes: this.$.autonSwitchCubes.value,
                autonScaleCubes: this.$.autonScaleCubes.value,
                allianceSwitchCubes: this.$.allianceSwitchCubes.value,
                opposingSwitchCubes: this.$.opposingSwitchCubes.value,
                teleopScaleCubes: this.$.teleopScaleCubes.value,
                exchange: this.$.exchange.value,
								climb: !this.$.climb.value,
                assistedOption: this.$.assistedOption.value,
      			};
      			console.log(this.$.mobility.checked);
      			console.log(this.$.mobility.checked? 1 : 0);
      			//console.log(!this.$.yellow_card.checked);
	  				//console.log(this.$.comments.value);
	  				//console.log(this.$.successgr);
	  				//console.log(this.$.successgr.selected);
	  				console.log(info);
	  				/*console.log(this.$.team.value);
    				  console.log(form.serialize());*/
                var base = this;
      			$.ajax({
      			    url: "/scout",
      			    type: "post",
      			    data: info,//scout_form.serialize(),
      			    success: function(data) {
                    base.set_notif_normal_message("Successfully Updated!");
                    console.log("Result: " + data.result);
                    /*if (data.result === "success") {
      			            this.set_notif_normal_message("Successfully Updated!");
                    } else if (data.result === "invalid") {
      			            // TODO: Do we even need this?
                        this.set_notif_error_message("Invalid data! "
                        + "Make sure that all inputs are less than 255 and greater than 0");
      			        }*/
      			    },
      			    error: function() {
                    base.set_notif_error_message("Failed to update!"
                        + " Either your internet is bad, or your data is invalid! (counters must be 0 to 255 only)");
                    /*(base.set_notif_error_message("Invalid data! "
                    + "Make sure that all inputs are less than 255 and greater than 0");*/
      			        /*$("#error_log").html("Failed to update. Try using QR (once we get that up and running)");
      			        $("#success_log").html("");*/
      			    }
						});
    		}
    }
    window.customElements.define(MyInputData.is, MyInputData);
  </script>
</dom-module>
