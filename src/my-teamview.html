<script type="text/javascript" src="/lib/jquery-3.2.1.min.js"> </script>
<link rel="import" href="../bower_components/polymer/polymer-element.html">
<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/paper-button/paper-button.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">

<dom-module id="my-teamview">
    <template>           
        <paper-input id="team_number_input" always-float-label label="Team Number: "></paper-input>
        <paper-button raised on-click="submit_query_team"> Display Data </paper-button>
        <div id="teamdata">
        </div>
        <br>
        
        <div id="averages">
        </div>
        <br>

        <div id="linegraph">
        </div>
        <br>
                
    </template>
    <script>
        google.charts.load('current', {'packages': ["table"]});
        class MyTeamView extends Polymer.Element {
            static get is() { return 'my-teamview' }
            submit_query_team() {
                var team_number = this.$.team_number_input.value;
                var base = this;
                $.ajax({
                    url: "/getteamdata?team_number=" + team_number,
                    type: "GET",
                    success: function(data) {
                        base.generate_graph(data, base);        
                    }
                });
            }

            generate_graph(data,base) {
                google.charts.load('45', {packages: ['corechart', 'table']});
                google.charts.setOnLoadCallback(function() {base.drawTable(data,base);});
            } 

            drawDataForTable(data, base, table) {
                table.addColumn('number', 'Match #');
                table.addColumn('string', 'Mobility');
                table.addColumn('number', 'Switch Auton');
                table.addColumn('number', 'Cubes in Scale');
                table.addColumn('number', 'Cubes in Exchange');
                table.addColumn('string', 'Climb?');

                for(var team in data) {
                    var matchstat = data[team];
                    for(var i = 0; i < matchstat.length; i++) {
                        var stat = [];
                        
                        stat.push(matchstat[i]["match_number"]);
                        stat.push(matchstat[i]["mobility"]);
                        stat.push(matchstat[i]["autonSwitchCubes"]);
                        stat.push(matchstat[i]["autonScaleCubes"] + matchstat[i]["teleopScaleCubes"]);
                        stat.push(matchstat[i]["exchange"]);
                        stat.push(matchstat[i]["climb"]);
                        table.addRow(stat);
                   }
                }
            }
            
            /* 
            average(data, key) {
                var sum = 0.0;
                var amount = 0;
                data.forEach(function(match) {   
                    sum += match[key];
                    amount++;
                });
                return sum/amount;
            }*/

            drawTable(data, base) {
                var table = new google.visualization.DataTable();
                base.drawDataForTable(data, base, table);
                var options = {"allowHtml": "true",
                    "title": "Competition View",
                    "page": "enable",
                    "pagetitleSize": 3,
                    "pagingButtons": "both"};
                
                var chart = new google.visualization.Table(base.$.teamdata);
                chart.draw(table, options); 
            }
        }
    window.customElements.define(MyTeamView.is, MyTeamView);
    </script>
</dom-module>
